# Generated by Django 3.2.24 on 2024-04-08 11:20

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("discount", "0074_add_index_for_unique_type"),
    ]

    operations = [
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql="""
                        DO
                        $do$
                        BEGIN
                        IF NOT EXISTS (
                            SELECT 1 FROM pg_catalog.pg_constraint
                            WHERE conname LIKE 'unique_checkoutline_discount_type'
                        ) THEN
                            ALTER TABLE discount_checkoutlinediscount
                            ADD CONSTRAINT unique_checkoutline_discount_type
                            UNIQUE USING INDEX unique_checkoutline_discount_type;
                        END IF;
                        END
                        $do$
                    """,
                    reverse_sql="""
                        ALTER TABLE discount_checkoutlinediscount
                        DROP CONSTRAINT IF EXISTS unique_checkoutline_discount_type;
                    """,
                ),
                migrations.RunSQL(
                    sql="""
                        DO
                        $do$
                        BEGIN
                        IF NOT EXISTS (
                            SELECT 1 FROM pg_catalog.pg_constraint
                            WHERE conname LIKE 'unique_orderline_discount_type'
                        ) THEN
                            ALTER TABLE discount_orderlinediscount
                            ADD CONSTRAINT unique_orderline_discount_type
                            UNIQUE USING INDEX unique_orderline_discount_type;
                        END IF;
                        END
                        $do$
                    """,
                    reverse_sql="""
                        ALTER TABLE discount_orderlinediscount
                        DROP CONSTRAINT IF EXISTS unique_orderline_discount_type;
                    """,
                ),
            ],
            state_operations=[
                migrations.AddConstraint(
                    model_name="checkoutlinediscount",
                    constraint=models.UniqueConstraint(
                        fields=("line_id", "unique_type"),
                        name="unique_checkoutline_discount_type",
                    ),
                ),
                migrations.AddConstraint(
                    model_name="orderlinediscount",
                    constraint=models.UniqueConstraint(
                        fields=("line_id", "unique_type"),
                        name="unique_orderline_discount_type",
                    ),
                ),
            ],
        )
    ]
